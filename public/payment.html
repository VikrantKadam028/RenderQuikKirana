<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Bill Completion</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
    />

    <style>
      /* General Styles */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Poppins", sans-serif;
      }

      body {
        background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        /* Center vertically */
      }
      .main {
        width: 100vw;
        height: 100vh;
        background-color: white;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      /* Completion Card Styles */
      .completion-card {
        background: white;
        border-radius: 20px;
        padding: 30px;
        width: 100%;
        max-width: 400px;
        text-align: center;

        transition: transform 0.2s ease-in-out;
      }

      .completion-card:hover {
        transform: translateY(-5px);
      }

      /* Success Icons Styles */
      .success-icons {
        position: relative;
        height: auto;
        width: 90%;
        margin-bottom: 20px;
        display: flex;
        justify-content: center;
        align-items: center;
        margin: 0 auto;
      }

      .success-icons img {
        width: auto;
        height: 200px;
      }

      .circle-container {
        width: 90px;
        height: 90px;
        background: #8b4513;
        border-radius: 50%;
        position: absolute;
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        align-items: center;
        justify-content: center;
        animation: scaleIn 0.5s ease-out;
      }

      .circle-container svg {
        width: 50px;
        height: 50px;
        stroke: white;
        stroke-width: 2;
      }

      .check-circle {
        width: 60px;
        height: 60px;
        background: transparent;
        border-radius: 50%;
        position: absolute;
        left: 50%;
        transform: translateX(-50%);
        top: 60px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .check-circle svg {
        width: 30px;
        height: 30px;
        fill: #4caf50;
        animation: drawCheck 0.8s ease-in-out forwards;
      }

      @keyframes scaleIn {
        from {
          transform: translateX(-50%) scale(0);
        }

        to {
          transform: translateX(-50%) scale(1);
        }
      }

      @keyframes slideUp {
        from {
          transform: translateX(-50%) translateY(20px);
          opacity: 0;
        }

        to {
          transform: translateX(-50%) translateY(0);
          opacity: 1;
        }
      }

      @keyframes drawCheck {
        0% {
          stroke-dasharray: 100 100;
          stroke-dashoffset: 100;
        }

        100% {
          stroke-dasharray: 100 100;
          stroke-dashoffset: 0;
        }
      }

      /* No UPI Message Styles */
      .no-upi-message {
        background: #f8f9fa;
        border-radius: 12px;
        padding: 20px;
        margin: 20px 0;
        color: #666;
        font-size: 14px;
        line-height: 1.5;
        border: 1px dashed #ccc;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .no-upi-message:hover {
        background: #e9ecef;
        transform: scale(1.02);
      }

      /* UPI Setup Page Styles */
      .setup-page {
        display: none;
        width: 100%;
        max-width: 400px;
        background: white;
        border-radius: 20px;
        padding: 30px;
      }

      .setup-header {
        display: flex;
        align-items: center;
        margin-bottom: 30px;
      }

      .back-btn {
        background: none;
        border: none;
        font-size: 24px;
        cursor: pointer;
        margin-right: 15px;
        color: #2c5364;
        /* Add color to back button */
      }

      .input-group {
        margin-bottom: 20px;
      }

      .input-group label {
        display: block;
        margin-bottom: 8px;
        color: #333;
        font-size: 14px;
      }

      .input-group input {
        width: 100%;
        padding: 12px;
        border: 1px solid #ddd;
        border-radius: 8px;
        font-size: 16px;
        transition: border-color 0.3s ease;
      }

      .input-group input:focus {
        border-color: #2c5364;
        outline: none;
        box-shadow: 0 0 5px rgba(0, 0, 0, 0.15);
        /* Add subtle focus shadow */
      }

      .update-btn {
        width: 100%;
        padding: 14px;
        background: #2c5364;
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 16px;
        cursor: pointer;
        transition: background-color 0.3s ease;
      }

      .update-btn:hover {
        background: #203a43;
      }

      /* Bill Amount Styles */
      .bill-amount {
        margin-bottom: 20px;
        font-weight: 600;
        background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
        color: white;
        padding: 15px 20px;
        border-radius: 10px;
      }

      /* Action Buttons Styles */
      .action-buttons {
        display: flex;
        justify-content: space-evenly;
        margin-bottom: 20px;
        align-items: center;
      }

      .action-buttons button {
        padding: 10px 20px;
        width: 100%;
        height: 60px;
        border: none;
        border-radius: 8px;

        color: white;
        cursor: pointer;
        margin-right: 10px;
        transition: background-color 0.2s ease-in-out;
      }

      .action-buttons button:hover {
        background: #1e3138;
      }

      .action-buttons button svg {
        margin-right: 5px;
      }

      /* New Bill, Edit, and Home Button Styles */

      .edit-btn,
      .home-btn {
        width: 100%;
        margin-top: 10px;
        padding: 12px;
        border: none;
        border-radius: 8px;
        background: #2c5364;
        color: white;
        cursor: pointer;
        transition: background-color 0.2s ease-in-out;
      }

      #qrcode {
        padding: 20px 20px;
      }

      .new-bill-btn:hover,
      .edit-btn:hover,
      .home-btn:hover {
        background: #1e3138;
      }
      #share {
        background-color: #1fd100;
      }
      #bill {
        background-color: black;
      }
      #bill i {
        margin-right: 8px;
      }
      #share,
      #bill {
        font-size: 16px;
        font-weight: 700;
        text-align: center;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      #ordertext {
        font-size: 30px;
        font-weight: 700;
        color: rgb(6, 125, 243);
      }
    </style>
  </head>

  <body>
    <div class="main">
      <div class="completion-card" id="completionCard">
        <div class="success-icons">
          <img src="tick.gif" />
        </div>
        <h2 id="ordertext">Order Completed!</h2>
        <div class="no-upi-message" id="upiMessage" onclick="showUPISetup()">
          Enter UPI ID to create QR code to accept payments
        </div>
        <div id="qrcode"></div>
        <div class="bill-amount">
          Total Bill Amount: ₹<span id="totalAmount"></span>
          <div>Tap to Tally Items</div>
        </div>
        <div class="action-buttons">
          <button class="btn share-btn" id="share">
            <svg
              width="20"
              height="20"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"></path>
              <polyline points="16 6 12 2 8 6"></polyline>
              <line x1="12" y1="2" x2="12" y2="15"></line>
            </svg>
            Share
          </button>
          <button class="btn new-bill-btn" id="bill">
            <i class="fa fa-envelope" style="font-size: 18px"></i>New Bill
          </button>
        </div>

        <button class="btn home-btn">Go to Homepage</button>
      </div>

      <!-- UPI Setup Page -->
      <div class="setup-page" id="setupPage">
        <div class="setup-header">
          <button class="back-btn" onclick="hideUPISetup()">←</button>
          <h2>Shop Details</h2>
        </div>

        <div class="input-group">
          <label>Address</label>
          <input type="text" id="address" placeholder="Enter address" />
        </div>
        <div class="input-group">
          <label>UPI ID</label>
          <input type="text" id="upiId" placeholder="Enter UPI ID" />
        </div>

        <div class="input-group">
          <label>Shop Phone Number (Optional)</label>
          <input type="tel" id="phone" placeholder="Enter phone number" />
        </div>
        <div class="input-group">
          <label>FSSAI Number (Optional)</label>
          <input type="text" id="fssai" placeholder="Enter FSSAI number" />
        </div>
        <button class="update-btn" onclick="updateDetails()">
          Update Details
        </button>
      </div>
    </div>
    <script>
      let upiId = localStorage.getItem("upiId") || "";
      const completionCard = document.getElementById("completionCard");
      const setupPage = document.getElementById("setupPage");
      const upiMessage = document.getElementById("upiMessage");
      const qrcodeContainer = document.getElementById("qrcode");
      const storedTotal = parseFloat(localStorage.getItem("totalAmount"));

      // Display the total amount on the page
      const totalAmountElement = document.getElementById("totalAmount");
      totalAmountElement.textContent = storedTotal.toFixed(2);

      document.getElementById("share").addEventListener("click", () => {
        // Create a temporary canvas to capture the bill details
        const canvas = document.createElement("canvas");
        const ctx = canvas.getContext("2d");

        // Get necessary data
        const billAmount = document.querySelector(".bill-amount").textContent;
        const shopName = "Your Shop Name"; // Replace with actual shop name
        const shopNumber = "1234567890"; // Replace with actual shop number

        // Style the canvas content
        ctx.font = "16px Arial";
        ctx.fillText("Shop Name:", 20, 40);
        ctx.fillText(shopName, 120, 40);
        ctx.fillText("Shop Number:", 20, 60);
        ctx.fillText(shopNumber, 120, 60);
        ctx.fillText("Total Amount:", 20, 80);
        ctx.fillText(billAmount, 120, 80);
        // Add more details as needed (e.g., itemized list)

        // Create a data URL from the canvas
        const dataURL = canvas.toDataURL("image/png");

        // Use the device's built-in sharing functionality (may vary slightly depending on the browser)
        navigator
          .share({
            title: "Your Shop Bill",
            text: "Here is your bill!",
            files: [new File([dataURL], "bill.png", { type: "image/png" })],
          })
          .then(() => console.log("Share successful"))
          .catch((error) => console.error("Error sharing:", error));
      });

      function showUPISetup() {
        completionCard.style.display = "none";
        setupPage.style.display = "block";
      }

      function hideUPISetup() {
        setupPage.style.display = "none";
        completionCard.style.display = "block";
      }
      function removeUPIFromLocalStorage() {
        localStorage.removeItem("upiId");
        generateQRCode(); // Re-run the function after removing the UPI ID
      }

      function updateDetails() {
        showLoading();
        const newUpiId = document.getElementById("upiId").value;
        if (newUpiId) {
          localStorage.setItem("upiId", newUpiId);
          upiId = newUpiId;
          generateQRCode();
        }
        setTimeout(() => {
          hideUPISetup();
        }, 1500);
      }

      function generateQRCode() {
        qrcodeContainer.innerHTML = "";
        if (upiId) {
          upiMessage.style.display = "none";
          qrcodeContainer.style.display = "block";
          const upiUrl = `upi://pay?pa=${upiId}&pn=Store&am=87.0&cu=INR`;
          new QRCode(qrcodeContainer, {
            text: upiUrl,
            width: 200,
            height: 200,
            colorDark: "#000000",
            colorLight: "#ffffff",
          });
        } else {
          upiMessage.style.display = "block";
          qrcodeContainer.style.display = "none";
        }
      }

      function showLoading() {
        const loading = document.createElement("div");
        loading.className = "loading";
        loading.innerHTML = `
                <div class="spinner"></div>
                <p style="color: white; margin-top: 20px;">Processing...</p>
            `;
        document.body.appendChild(loading);
        setTimeout(() => {
          loading.remove();
        }, 1500);
      }

      if (upiId) {
        generateQRCode();
      }

      // Event Listeners
      document
        .querySelector(".share-btn")
        .addEventListener("click", showLoading);
      document.querySelector(".print-btn").addEventListener("click", () => {
        showLoading();
        window.print();
      });
      document
        .querySelector(".new-bill-btn")
        .addEventListener("click", showLoading);
      document
        .querySelector(".home-btn")
        .addEventListener("click", showLoading);

      removeUPIFromLocalStorage();
    </script>
  </body>
</html>
