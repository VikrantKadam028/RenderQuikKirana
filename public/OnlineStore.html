<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>Online Store Settings</title>
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap"
    />
    <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-7ZX93BPWK1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-7ZX93BPWK1');
</script>
    <style>
      :root {
        --background-color: #ffffff;
        --text-color: #000000;
        --border-color: #e5e7eb;
        --primary-color: #2563eb;
        --primary-hover: #1d4ed8;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Poppins", sans-serif;
        color: var(--text-color);
      }

      body {
        background-color: var(--background-color);
        min-height: 100vh;
        outline: none;
        -webkit-tap-highlight-color: transparent;
        -webkit-user-select: none;
      }

      .loader {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        border: 5px solid #f3f3f3;
        border-top: 5px solid var(--primary-color);
        border-radius: 50%;
        width: 50px;
        height: 50px;
        animation: spin 1s linear infinite;
        z-index: 1000;
      }

      @keyframes spin {
        0% {
          transform: translate(-50%, -50%) rotate(0deg);
        }
        100% {
          transform: translate(-50%, -50%) rotate(360deg);
        }
      }

      .container {
        max-width: 600px;
        margin: 0 auto;
        background: var(--background-color);
        min-height: 100vh;
        display: none;
      }

      .header {
        background-color: var(--background-color);
        padding: 1rem;
        padding-top: 30px;
        display: flex;
        align-items: center;
        position: sticky;
        top: 0;
        z-index: 10;
      }

      .back-button {
        background: none;
        border: none;
        color: var(--text-color);
        font-size: 1.5rem;
        cursor: pointer;
        padding: 8px;
      }

      .title {
        font-size: 1.35rem;
        font-weight: 800;
        margin-left: 12px;
      }

      main {
        padding: 16px;
      }

      .setting-item {
        padding: 16px 0;
        border-bottom: 1px solid var(--border-color);
      }

      .setting-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .setting-header h2 {
        font-size: 18px;
        color: var(--text-color);
      }

      /* Switch Toggle */
      .switch {
        position: relative;
        display: inline-block;
        width: 46px;
        height: 24px;
      }

      .switch input {
        opacity: 0;
        width: 0;
        height: 0;
      }

      .slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #ccc;
        transition: 0.4s;
        border-radius: 34px;
      }

      .slider:before {
        position: absolute;
        content: "";
        height: 20px;
        width: 20px;
        left: 2px;
        bottom: 2px;
        background-color: white;
        transition: 0.4s;
        border-radius: 50%;
      }

      input:checked + .slider {
        background-color: var(--primary-color);
      }

      input:checked + .slider:before {
        transform: translateX(22px);
      }

      /* URL Section */
      .url-section {
        margin: 20px 0;
      }

      .url-section h3 {
        font-size: 16px;
        font-weight: 400;
        margin-bottom: 12px;
        color: #1f2937;
      }

      .url-box {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px 16px;
        background: white;
        border: 1px solid var(--border-color);
        border-radius: 8px;
      }

      .url {
        color: var(--primary-color);
        font-size: 15px;
        text-decoration: none;
        word-break: break-all;
        cursor: pointer;
      }

      .url-actions {
        display: flex;
        gap: 12px;
        flex-shrink: 0;
      }

      .icon-btn {
        display: flex;
        align-items: center;
        gap: 8px;
        background: none;
        border: none;
        color: #6b7280;
        cursor: pointer;
        padding: 8px;
        transition: color 0.3s;
      }

      .icon-btn:hover {
        color: var(--primary-color);
      }

      .icon-btn span {
        font-size: 14px;
      }

      /* Input Sections */
      .input-section {
        margin: 24px 0;
      }

      .input-section label {
        display: block;
        font-size: 16px;
        color: #1f2937;
        margin-bottom: 8px;
      }

      .phone-input {
        position: relative;
      }

      .phone-input input,
      textarea {
        width: 100%;
        padding: 12px;
        border: 1px solid var(--border-color);
        border-radius: 8px;
        font-size: 16px;
        transition: border-color 0.3s;
      }

      .phone-input input:focus,
      textarea:focus {
        outline: none;
        border-color: var(--primary-color);
      }

      .counter {
        position: absolute;
        right: 12px;
        top: 50%;
        transform: translateY(-50%);
        color: #6b7280;
        font-size: 14px;
      }

      textarea {
        min-height: 120px;
        resize: vertical;
      }

      .update-btn {
        width: 100%;
        padding: 14px;
        background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 16px;
        cursor: pointer;
        transition: background-color 0.3s;
        /* margin-top: 24px; */
      }

      .update-btn:disabled {
        opacity: 0.7;
        cursor: not-allowed;
      }

      .setting-item.clickable {
        cursor: pointer;
        transition: background-color 0.3s;
      }

      .setting-item.clickable:hover {
        background-color: #f8f9fa;
      }

      @media (max-width: 480px) {
        .url-box {
          flex-direction: column;
          gap: 12px;
          align-items: flex-start;
        }

        .url-actions {
          align-self: flex-end;
        }

        .title {
          font-size: 1.2rem;
        }
      }

      .toast {
        position: fixed;
        bottom: 40px;
        left: 50%;
        width: 80%;
        transform: translateX(-50%);
        background-color: #333;
        color: white;
        padding: 12px 24px;
        border-radius: 8px;
        display: none;
        z-index: 1000;
      }
    </style>
  </head>
  <body>
    <div class="loader" id="loader"></div>
    <div class="toast" id="toast"></div>

    <div class="container" id="content">
      <header class="header">
        <button class="back-button" onclick="history.back()">‚Üê</button>
        <h1 class="title">Setup Online Store</h1>
      </header>

      <main>
        <div class="setting-item">
          <div class="setting-header">
            <h2>Online store</h2>
            <label class="switch">
              <input type="checkbox" id="onlineStoreToggle" />
              <span class="slider"></span>
            </label>
          </div>
        </div>

        <div class="url-section" id="urlSection" style="display: none">
          <h3>Online Shop URL -</h3>
          <div class="url-box">
            <a href="#" class="url" id="shopUrl" target="_blank"></a>
            <span class="url" id="shopUrl"></span>
            <div class="url-actions">
              <button class="icon-btn" id="copyBtn">
                <svg
                  width="20"
                  height="20"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                  <path
                    d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"
                  ></path>
                </svg>
                <span>Copy</span>
              </button>
              <button class="icon-btn" id="shareBtn">
                <svg
                  width="20"
                  height="20"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"></path>
                  <polyline points="16 6 12 2 8 6"></polyline>
                  <line x1="12" y1="2" x2="12" y2="15"></line>
                </svg>
                <span>Share</span>
              </button>
            </div>
          </div>
        </div>

        <div class="setting-item" id="deliveryOption" style="display: none">
          <div class="setting-header">
            <h2>Do you deliver?</h2>
            <label class="switch">
              <input type="checkbox" id="deliveryToggle" />
              <span class="slider"></span>
            </label>
          </div>
        </div>

        <div class="setting-item clickable">
          <div class="setting-header">
            <h2>Create offers for online store</h2>
            <svg
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <polyline points="9 18 15 12 9 6"></polyline>
            </svg>
          </div>
        </div>

        <div class="input-section" id="phoneInput" style="display: none">
          <label>Shop Phone Number</label>
          <div class="phone-input">
            <input
              type="tel"
              id="phoneNumber"
              maxlength="10"
              placeholder="Enter phone number"
            />
            <span class="counter">0/10</span>
          </div>
        </div>

        <div class="input-section" id="noteForCustomers" style="display: none">
          <label>Note for customers</label>
          <textarea
            id="customerNote"
            placeholder="Write a note for your customers..."
          ></textarea>
        </div>

        <button class="update-btn" id="updateBtn">Update</button>
      </main>
    </div>

    <script>
      // Show toast message function
      function showToast(message, duration = 2000) {
        const toast = document.getElementById("toast");
        toast.textContent = message;
        toast.style.display = "block";
        setTimeout(() => {
          toast.style.display = "none";
        }, duration);
      }

      // Load saved settings when page loads
      window.addEventListener("load", () => {
        document.getElementById("loader").style.display = "none";
        document.getElementById("content").style.display = "block";

        // Load saved settings from localStorage
        const savedSettings = JSON.parse(
          localStorage.getItem("storeSettings") || "{}"
        );
        const savedPhone = localStorage.getItem("PhoneNumber") || "";

        // Apply saved settings
        document.getElementById("onlineStoreToggle").checked =
          savedSettings.isOnline || false;
        document.getElementById("deliveryToggle").checked =
          savedSettings.isDeliveryEnabled || false;
        document.getElementById("phoneNumber").value =
          savedSettings.phoneNumber || savedPhone;
        document.getElementById("customerNote").value =
          savedSettings.customerNote || "";

        // Update phone counter
        const phoneLength = document.getElementById("phoneNumber").value.length;
        document.querySelector(".counter").textContent = `${phoneLength}/10`;

        // Trigger the toggle event to show/hide sections
        document
          .getElementById("onlineStoreToggle")
          .dispatchEvent(new Event("change"));
      });

      // Generate and update URL when store is toggled
      document
        .getElementById("onlineStoreToggle")
        .addEventListener("change", function () {
          const phoneNumber =
            localStorage.getItem("PhoneNumber") ||
            document.getElementById("phoneNumber")?.value ||
            "defaultNumber"; // Fallback to default if missing

          const contentSections = [
            "urlSection",
            "deliveryOption",
            "phoneInput",
            "noteForCustomers",
          ];

          contentSections.forEach((sectionId) => {
            const section = document.getElementById(sectionId);
            if (section) {
              if (this.checked) {
                section.style.display = "block";

                // Generate and set URL for urlSection
                if (sectionId === "urlSection") {
                  const generatedUrl = `https://renderquikkirana.onrender.com/ActualStore.html?phone=${phoneNumber}`;
                  const shopUrlElement = document.getElementById("shopUrl");

                  if (shopUrlElement) {
                    shopUrlElement.textContent = generatedUrl;
                    shopUrlElement.href = generatedUrl; // Make it clickable
                    shopUrlElement.setAttribute("target", "_blank"); // Open in new tab
                    shopUrlElement.setAttribute("rel", "noopener noreferrer"); // Improve security
                  }
                }
              } else {
                section.style.display = "none";
              }
            }
          });
        });

      // Phone number input handling
      document
        .getElementById("phoneNumber")
        .addEventListener("input", function () {
          let value = this.value.replace(/\D/g, "");
          if (value.length > 13) value = value.slice(0, 10);
          this.value = value;
          document.querySelector(".counter").textContent = `${value.length}/13`;

          // Update URL if store is online
          if (document.getElementById("onlineStoreToggle").checked) {
            const generatedUrl = `https://renderquikkirana.onrender.com/ActualStore.html?phone=${value}`;
            const shopUrlElement = document.getElementById("shopUrl");

            if (shopUrlElement) {
              shopUrlElement.textContent = generatedUrl;
              shopUrlElement.href = generatedUrl; // Make it clickable
              shopUrlElement.setAttribute("target", "_blank"); // Open in new tab
              shopUrlElement.setAttribute("rel", "noopener noreferrer"); // Improve security
            }
          }
        });

      // Copy URL functionality
      document.getElementById("copyBtn").addEventListener("click", function () {
        const url = document.getElementById("shopUrl").textContent;
        navigator.clipboard
          .writeText(`https://${url}`)
          .then(() => {
            showToast("URL copied to clipboard!");
            const span = this.querySelector("span");
            span.textContent = "Copied!";
            setTimeout(() => (span.textContent = "Copy"), 2000);
          })
          .catch((err) => {
            showToast("Failed to copy URL");
            console.error("Failed to copy URL:", err);
          });
      });

      // Share functionality with modern sharing options
      document
        .getElementById("shareBtn")
        .addEventListener("click", async function () {
          const url = document.getElementById("shopUrl").textContent;
          const shareData = {
            title: "My Online Store",
            text: "Check out my online store!",
            url: `https://${url}`,
          };

          if (navigator.share) {
            try {
              await navigator.share(shareData);
              showToast("Shared successfully!");
            } catch (err) {
              if (err.name !== "AbortError") {
                showToast("Error sharing URL");
                console.log("Error sharing:", err);
              }
            }
          } else {
            // Fallback for browsers that don't support Web Share API
            navigator.clipboard.writeText(`https://${url}`);
            const span = this.querySelector("span");
            span.textContent = "Copied!";
            setTimeout(() => (span.textContent = "Share"), 2000);
            showToast("URL copied to clipboard (sharing not supported)");
          }
        });

      // Clickable items functionality
      document.querySelectorAll(".setting-item.clickable").forEach((item) => {
        item.addEventListener("click", function () {
          this.style.backgroundColor = "#f3f4f6";
          setTimeout(() => {
            this.style.backgroundColor = "";
          }, 200);

          // Get the heading text to identify which item was clicked
          const heading = this.querySelector("h2").textContent;

          // Handle different clickable items
          switch (heading) {
            case "Create offers for online store":
              showToast("Opening offers section...");
              // Add your navigation or modal logic here
              break;
            case "Enable or disable products":
              showToast("Opening products section...");
              // Add your navigation or modal logic here
              break;
          }
        });
      });

      // Save all settings to localStorage when update button is clicked
      document
        .getElementById("updateBtn")
        .addEventListener("click", function () {
          // Validate phone number
          const phoneNumber = document.getElementById("phoneNumber").value;
          if (
            document.getElementById("onlineStoreToggle").checked &&
            phoneNumber.length !== 10
          ) {
            showToast("Please enter a valid 10-digit phone number");
            return;
          }

          this.textContent = "Updating...";
          this.disabled = true;

          // Collect all settings
          const settings = {
            isOnline: document.getElementById("onlineStoreToggle").checked,
            phoneNumber: phoneNumber,
            customerNote: document.getElementById("customerNote").value,
            isDeliveryEnabled:
              document.getElementById("deliveryToggle").checked,
            lastUpdated: new Date().toISOString(),
          };

          try {
            // Save to localStorage
            localStorage.setItem("storeSettings", JSON.stringify(settings));
            localStorage.setItem("PhoneNumber", phoneNumber);

            // Update button UI to show success
            setTimeout(() => {
              this.textContent = "Updated!";
              this.style.background = "#10b981";
              showToast("Settings saved successfully!");

              setTimeout(() => {
                this.textContent = "Update";
                this.style.background =
                  "linear-gradient(135deg, #0f2027, #203a43, #2c5364)";
                this.disabled = false;
              }, 1500);
            }, 1000);
          } catch (error) {
            showToast("Error saving settings");
            console.error("Error saving settings:", error);
            this.textContent = "Update";
            this.disabled = false;
          }
        });

      // Textarea auto-resize
      document.querySelector("textarea").addEventListener("input", function () {
        this.style.height = "auto";
        this.style.height = this.scrollHeight + "px";
      });

      // Handle back button
      window.addEventListener("popstate", function (event) {
        // Save any unsaved changes before navigating away
        const unsavedChanges = checkForUnsavedChanges();
        if (unsavedChanges) {
          if (
            confirm(
              "You have unsaved changes. Do you want to save them before leaving?"
            )
          ) {
            document.getElementById("updateBtn").click();
          }
        }
      });

      // Function to check for unsaved changes
      function checkForUnsavedChanges() {
        const savedSettings = JSON.parse(
          localStorage.getItem("storeSettings") || "{}"
        );
        const currentSettings = {
          isOnline: document.getElementById("onlineStoreToggle").checked,
          phoneNumber: document.getElementById("phoneNumber").value,
          customerNote: document.getElementById("customerNote").value,
          isDeliveryEnabled: document.getElementById("deliveryToggle").checked,
        };

        return (
          JSON.stringify(savedSettings) !== JSON.stringify(currentSettings)
        );
      }

      // Prevent accidental navigation when there are unsaved changes
      window.addEventListener("beforeunload", function (e) {
        if (checkForUnsavedChanges()) {
          e.preventDefault();
          e.returnValue = "";
        }
      });
    </script>
  </body>
</html>
